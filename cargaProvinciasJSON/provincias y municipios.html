<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Provincias y Municipios</title>
</head>
<body>
  <h2>Selecciona</h2>

  <label for="selectProvincias">Provincia:</label>
  <select id="selectProvincias">
    <option value="">-- Selecciona una provincia --</option>
  </select>

  <label for="selectMunicipios">Municipio:</label>
  <select id="selectMunicipios">
    <option value="">-- Selecciona un municipio --</option>
  </select>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      cargarProvincias();

      document.getElementById("selectProvincias").addEventListener("change", function () {
        const idProvinciaSeleccionada = this.value;

        if (idProvinciaSeleccionada) {
          cargarMunicipiosDeProvincia(idProvinciaSeleccionada);
        } else {
          limpiarMunicipios();
        }
      });
    });

    function cargarProvincias() {
      fetch("cargaProvinciasJSON.php")
        .then(respuesta => respuesta.json())
        .then(provincias => {
          const selectProvincias = document.getElementById("selectProvincias");
          selectProvincias.innerHTML = '<option value="">-- Selecciona una provincia --</option>';

          Object.entries(provincias).forEach(([idProvincia, nombreProvincia]) => {
            const opcionProvincia = document.createElement("option");
            opcionProvincia.value = idProvincia;
            opcionProvincia.textContent = nombreProvincia;
            selectProvincias.appendChild(opcionProvincia);
          });

          limpiarMunicipios();
        })
        .catch(error => console.error("Error cargando provincias:", error));
    }

    function cargarMunicipiosDeProvincia(idProvincia) {
      const datosFormulario = new FormData();
      // IMPORTANTE: tu PHP lee $_POST["provincia"], por eso la clave debe llamarse "provincia"
      datosFormulario.append("provincia", idProvincia);

      fetch("cargaMunicipiosJSON.php", {
        method: "POST",
        body: datosFormulario
      })
        .then(respuesta => respuesta.json())
        .then(municipios => {
          const selectMunicipios = document.getElementById("selectMunicipios");
          selectMunicipios.disabled = false;
          selectMunicipios.innerHTML = '<option value="">-- Selecciona un municipio --</option>';

          Object.entries(municipios).forEach(([idMunicipio, nombreMunicipio]) => {
            const opcionMunicipio = document.createElement("option");
            opcionMunicipio.value = idMunicipio;
            opcionMunicipio.textContent = nombreMunicipio;
            selectMunicipios.appendChild(opcionMunicipio);
          });
        })
        .catch(error => {
          console.error("Error cargando municipios:", error);
          limpiarMunicipios();
        });
    }

  
  </script>
</body>
</html>
